{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/lobster/projects/elimurobotics/node_modules/.pnpm/next-sanity%4011.6.10_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.13.1_%40sanity%2Bicons%403._e2ae38356e4eda8dbd94efeaf53e96e8/node_modules/next-sanity/dist/live/server-actions/index.js"],"sourcesContent":["\"use server\";\nimport { t as sanitizePerspective } from \"../../utils.js\";\nimport { perspectiveCookieName } from \"@sanity/preview-url-secret/constants\";\nimport { cookies, draftMode } from \"next/headers\";\nimport { revalidateTag } from \"next/cache\";\nasync function revalidateSyncTags(tags) {\n\tawait revalidateTag(\"sanity:fetch-sync-tags\", \"max\");\n\tfor (const _tag of tags) {\n\t\tconst tag = `sanity:${_tag}`;\n\t\trevalidateTag(tag, { expire: 0 });\n\t\tconsole.log(`<SanityLive /> revalidated tag: ${tag}`);\n\t}\n}\nasync function setPerspectiveCookie(perspective) {\n\tif (!(await draftMode()).isEnabled) return;\n\tconst sanitizedPerspective = sanitizePerspective(perspective, \"drafts\");\n\tif (perspective !== sanitizedPerspective) throw new Error(`Invalid perspective: ${perspective}`);\n\t(await cookies()).set(perspectiveCookieName, Array.isArray(sanitizedPerspective) ? sanitizedPerspective.join(\",\") : sanitizedPerspective, {\n\t\thttpOnly: true,\n\t\tpath: \"/\",\n\t\tsecure: true,\n\t\tsameSite: \"none\"\n\t});\n}\nexport { revalidateSyncTags, setPerspectiveCookie };\n\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":";;;;;;;IAwB6B,uBAAA,WAAA,GAAA,IAAA,8bAAA,EAAA,8CAAA,mbAAA,EAAA,KAAA,GAAA,ybAAA,EAAA"}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/next-sanity@11.6.10_@emotion+is-prop-valid@1.2.2_@sanity+client@7.13.1_@sanity+icons@3._e2ae38356e4eda8dbd94efeaf53e96e8/node_modules/next-sanity/dist/PresentationComlink2.js","sources":["file:///home/lobster/projects/elimurobotics/node_modules/.pnpm/next-sanity%4011.6.10_%40emotion%2Bis-prop-valid%401.2.2_%40sanity%2Bclient%407.13.1_%40sanity%2Bicons%403._e2ae38356e4eda8dbd94efeaf53e96e8/node_modules/next-sanity/src/live/client-components/live/PresentationComlink.tsx"],"sourcesContent":["import type {ClientPerspective} from '@sanity/client'\nimport {\n  createNode,\n  createNodeMachine,\n  // type Node,\n} from '@sanity/comlink'\nimport {setPerspectiveCookie} from 'next-sanity/live/server-actions'\nimport {\n  createCompatibilityActors,\n  type LoaderControllerMsg,\n  type LoaderNodeMsg,\n} from '@sanity/presentation-comlink'\nimport {useRouter} from 'next/navigation'\nimport {\n  useEffect,\n  // useState\n} from 'react'\nimport {useEffectEvent} from 'use-effect-event'\nimport {setComlink, setComlinkClientConfig} from '../../hooks/context'\n\nfunction PresentationComlink(props: {\n  projectId: string\n  dataset: string\n  // handleDraftModeAction: (secret: string) => Promise<void | string>\n  draftModeEnabled: boolean\n  draftModePerspective: ClientPerspective\n}): React.JSX.Element | null {\n  const {projectId, dataset, draftModeEnabled, draftModePerspective} = props\n  const router = useRouter()\n\n  // const [presentationComlink, setPresentationComlink] = useState<Node<\n  //   LoaderControllerMsg,\n  //   LoaderNodeMsg\n  // > | null>(null)\n\n  useEffect(() => {\n    setComlinkClientConfig(projectId, dataset)\n  }, [dataset, projectId])\n\n  const handlePerspectiveChange = useEffectEvent(\n    (perspective: ClientPerspective, signal: AbortSignal) => {\n      if (draftModeEnabled && perspective !== draftModePerspective) {\n        setPerspectiveCookie(perspective)\n          .then(() => {\n            if (signal.aborted) return\n            router.refresh()\n          })\n          // eslint-disable-next-line no-console\n          .catch((reason) => console.error('Failed to set the preview perspective cookie', reason))\n      }\n    },\n  )\n\n  // const [status, setStatus] = useState('disconnected')\n  useEffect(() => {\n    const comlink = createNode<LoaderNodeMsg, LoaderControllerMsg>(\n      {\n        name: 'loaders',\n        connectTo: 'presentation',\n      },\n      createNodeMachine<LoaderNodeMsg, LoaderControllerMsg>().provide({\n        actors: createCompatibilityActors<LoaderNodeMsg>(),\n      }),\n    )\n\n    // comlink.onStatus((status) => {\n    //   setStatus(status)\n    // })\n\n    let controller: AbortController | undefined\n    comlink.on('loader/perspective', (data) => {\n      controller?.abort()\n      controller = new AbortController()\n      handlePerspectiveChange(data.perspective, controller.signal)\n    })\n\n    const stop = comlink.start()\n    // setPresentationComlink(comlink)\n    setComlink(comlink)\n    // eslint-disable-next-line no-console\n    // console.log('setting comlink', comlink)\n    return () => {\n      // eslint-disable-next-line no-console\n      // console.log('stopping comlink')\n      stop()\n    }\n  }, [])\n\n  // @TODO come back to this later\n  // const handleEnableDraftMode = useEffectEvent(async (signal: AbortSignal) => {\n  //   if (signal.aborted) return\n  //   const {secret} = await (presentationComlink?.fetch(\n  //     {\n  //       type: 'loader/fetch-preview-url-secret' as const,\n  //       data: {projectId, dataset},\n  //     },\n  //     {signal},\n  //   ) || {secret: null})\n  //   if (signal.aborted) return\n  //   const error = await handleDraftModeAction(secret!)\n  //   // eslint-disable-next-line no-console\n  //   // @TODO call another server action here that can tell us if draft mode is actually enabled\n  //   if (error) {\n  //     // @TODO use sonnet or whatever to push a toast with the error\n  //     // eslint-disable-next-line no-console\n  //     console.error('Error enabling draft mode', error)\n  //     return\n  //   }\n  //   // console.log('Draft mode enabled?', {enabled})\n  //   if (signal.aborted) return\n  //   router.refresh()\n  // })\n  // const connected = status === 'connected'\n  // useEffect(() => {\n  //   if (connected && !draftModeEnabled) {\n  //     const controller = new AbortController()\n  //     handleEnableDraftMode(controller.signal).catch((reason) => {\n  //       // eslint-disable-next-line no-console\n  //       console.error('Failed to enable draft mode', reason)\n  //       return handleEnableDraftMode(controller.signal)\n  //     })\n  //     return () => {\n  //       controller.abort()\n  //     }\n  //   }\n  //   return undefined\n  // }, [connected, draftModeEnabled, handleEnableDraftMode])\n\n  return null\n}\nPresentationComlink.displayName = 'PresentationComlink'\n\nexport default PresentationComlink\n"],"names":["controller: AbortController | undefined"],"mappings":";;;;;;;;;;;;;;;;;;AAoBA,SAAS,oBAAoB,KAAA,EAMA;IAC3B,MAAM,EAAC,SAAA,EAAW,OAAA,EAAS,gBAAA,EAAkB,oBAAA,EAAA,GAAwB;IACrE,MAAM,aAAS,8VAAA,EAAW;IAO1B,IAAA,sXAAA;yCAAA,MAAgB;YACd,IAAA,2WAAA,EAAuB,WAAW,QAAQ;;wCACzC;QAAC;QAAS;KAAU,CAAC;IAExB,MAAM,8BAA0B,qQAAA;uEAAA,CAC7B,aAAgC,WAAwB;YACvD,IAAI,oBAAoB,gBAAgB,qBACtC,CAAA,IAAA,wbAAA,EAAqB,YAAY,CAC9B,IAAA;+EAAA,MAAW;oBACV,IAAI,OAAO,OAAA,CAAS,CAAA;oBACpB,OAAO,OAAA,EAAS;kBAChB;8EAED,KAAA;+EAAA,CAAO,SAAW,QAAQ,KAAA,CAAM,gDAAgD,OAAO,CAAC;;UAGhG;;IAGD,IAAA,sXAAA;yCAAA,MAAgB;YACd,MAAM,cAAU,qOAAA,EACd;gBACE,MAAM;gBACN,WAAW;aACZ,MACD,4OAAA,EAAuD,EAAC,OAAA,CAAQ;gBAC9D,YAAQ,iZAAA,EAA0C;YAAA,CACnD,CAAC,CACH;YAMD,IAAIA;YACJ,QAAQ,EAAA,CAAG;iDAAA,CAAuB,SAAS;oBACzC,YAAY,OAAO;oBACnB,aAAa,IAAI,iBAAiB;oBAClC,wBAAwB,KAAK,WAAA,EAAa,WAAW,MAAA,CAAO;kBAC5D;;YAEF,MAAM,OAAO,QAAQ,KAAA,EAAO;YAE5B,IAAA,2WAAA,EAAW,QAAQ;YAGnB;iDAAA,MAAa;oBAGX,MAAM;;;;wCAEP,EAAE,CAAC;IA0CN,OAAO;;AAET,oBAAoB,WAAA,GAAc;AAElC,IAAA,8BAAe"}}]
}